<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>SleepOn - ê²°ì œ</title>
    <meta lang="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <link href="/css/bootstrap.css" rel="stylesheet">
    <link href="/css/styles.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src=/js/bootstrap.bundle.js></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script>
        $(document).ready(function () {
            // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ë³¸ì ìœ¼ë¡œ ì¹´ë“œ ê²°ì œ ì •ë³´ë¥¼ ë³´ì´ê²Œ ì„¤ì •
            $('#cardPayment').removeClass('hidden');
            $('#bankPayment').addClass('hidden');
            $('#paymentMethod').val('card');

            $('#paymentType').on('change', function () {
                var paymentType = $(this).val();
                if (paymentType === 'card') {
                    $('#cardPayment').removeClass('hidden');
                    $('#bankPayment').addClass('hidden');
                    $('#paymentMethod').val('card');
                } else {
                    $('#cardPayment').addClass('hidden');
                    $('#bankPayment').removeClass('hidden');
                    $('#paymentMethod').val('bank');
                }
            });

            // ê²°ì œ ì •ë³´ ì…ë ¥ì‹œ '-' '/' ê¸°í˜¸ ì‚½ì…
            window.formatCardNumber = function (input) {
                let value = input.value.replace(/\D/g, '').replace(/(\d{4})(?=\d)/g, '$1-');
                input.value = value.substring(0, 19);
            }

            window.formatCardExpiry = function (input) {
                let value = input.value.replace(/\D/g, '').replace(/(\d{2})(?=\d)/g, '$1/');
                input.value = value.substring(0, 5);
            }

            window.formatAccountNumber = function (input) {
                let value = input.value.replace(/\D/g, '');
                let formattedValue = '';

                if (value.length <= 3) {
                    formattedValue = value;
                } else if (value.length <= 6) {
                    formattedValue = value.substring(0, 3) + '-' + value.substring(3, 6);
                } else if (value.length <= 10) {
                    formattedValue = value.substring(0, 3) + '-' + value.substring(3, 6) + '-' + value.substring(6, 10);
                } else {
                    formattedValue = value.substring(0, 3) + '-' + value.substring(3, 6) + '-' + value.substring(6, 10) + '-' + value.substring(10, 12);
                }

                input.value = formattedValue;
            }

            $('#reserveBtn').on('click', function () {
                const paymentType = $('#paymentType').val();
                const cardNumber = $('#cardNumber').val();
                const cardCvc = $('#cardCVC').val();
                const cardExpiry = $('#cardExpiry').val();
                const bankName = $('#bankName').val();
                const accountNumber = $('#accountNumber').val();
                const accountName = $('#accountName').val();
                if (paymentType === "card") {
                    if (!cardNumber || !cardCvc || !cardExpiry) {
                        alert("ê²°ì œ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                        return false;
                    }
                } else {
                    if (!bankName || !accountNumber || !accountName) {
                        alert("ê²°ì œ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                        return false;
                    }
                }
                const contentId = $('#contentId').val();
                const checkIn = $('#checkIn').val();
                const checkOut = $('#checkOut').val();
                const roomTitle = $("#roomtitle").val();
                const userCnt = $('#userCnt').val();

                // ì„ íƒëœ ê°’ë“¤ì„ URL íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê²¨ í˜ì´ì§€ ì´ë™
                window.location.href = "/SleepOn/reserve?contentId=" + encodeURIComponent(contentId)
                    + "&checkIn=" + encodeURIComponent(checkIn)
                    + "&checkOut=" + encodeURIComponent(checkOut)
                    + "&roomtitle=" + encodeURIComponent(roomTitle)
                    + "&userCnt=" + encodeURIComponent(userCnt);
            });

            $('.back-btn').on('click', function () {
                history.back();
            });
        });
    </script>
</head>
<body class="paymentBody">
<header th:replace="~{layout/header :: header-basic}"></header>
<header th:replace="~{layout/header :: header-banner}"></header>
<main>
    <section class="container">
        <div class="paymentContainer">
            <div class="paymentCard">
                <div class="paymentHeader">ì˜ˆì•½ ì •ë³´</div>
                <div class="paymentInfo">
                    <label><span>ğŸ“…</span>ì²´í¬ì¸</label>
                    <span th:text="${checkIn}"></span>
                    <label><span>ğŸ“…</span>ì²´í¬ì•„ì›ƒ</label>
                    <span th:text="${checkOut}"></span>
                    <label><span>ğŸ‘¤</span>ì¸ì›</label>
                    <span th:text="|${userCnt}ëª…|"></span>
                    <label><span>ğŸ </span>ê°ì‹¤</label>
                    <span th:text="${roomtitle}"></span>
                </div>
                <div>
                    <label class="paymentText" for="paymentType">ê²°ì œ ë°©ë²•</label>
                    <div class="inquiryInput">
                        <select class="BoxBorderNon" id="paymentType">
                            <option selected value="card">ì¹´ë“œ ê²°ì œ</option>
                            <option value="bank">ë¬´í†µì¥ ì…ê¸ˆ</option>
                        </select>
                    </div>
                </div>
                <div class="paymentSel" id="cardPayment">
                    <div>
                        <label class="paymentText" for="cardNumber">ì¹´ë“œ ë²ˆí˜¸</label>
                        <div class="inquiryInput">
                            <input class="BoxBorderNon" id="cardNumber" maxlength="19" oninput="formatCardNumber(this)"
                                   placeholder="1234-5678-9012-3456" type="text">
                        </div>
                    </div>
                    <div>
                        <label class="paymentText" for="cardExpiry">ìœ íš¨ ê¸°ê°„</label>
                        <div class="inquiryInput">
                            <input class="BoxBorderNon" id="cardExpiry" maxlength="5" oninput="formatCardExpiry(this)" placeholder="MM/YY"
                                   type="text">
                        </div>
                    </div>
                    <div>
                        <label class="paymentText" for="cardCVC">CVC</label>
                        <div class="inquiryInput">
                            <input class="BoxBorderNon" id="cardCVC" maxlength="3" placeholder="123"
                                   type="text">
                        </div>
                    </div>
                </div>
                <div class="paymentSel hidden" id="bankPayment">
                    <div>
                        <label class="paymentText" for="bankName">ì€í–‰ëª…</label>
                        <div class="inquiryInput">
                            <input class="BoxBorderNon" id="bankName" maxlength="10" placeholder="ì€í–‰ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" type="text">
                        </div>
                    </div>
                    <div>
                        <label class="paymentText" for="accountNumber">ê³„ì¢Œ ë²ˆí˜¸</label>
                        <div class="inquiryInput">
                            <input class="BoxBorderNon" id="accountNumber" maxlength="16" oninput="formatAccountNumber(this)"
                                   placeholder="123-456-7890-12" type="text">
                        </div>
                    </div>
                    <div>
                        <label class="paymentText" for="accountName">ì…ê¸ˆìëª…</label>
                        <div class="inquiryInput">
                            <input class="BoxBorderNon" id="accountName" maxlength="5" placeholder="í™ê¸¸ë™" type="text">
                        </div>
                    </div>
                </div>
                <input id="contentId" name="contentId" th:value="${contentId}" type="hidden">
                <input id="checkIn" name="checkIn" th:value="${checkIn}" type="hidden">
                <input id="checkOut" name="checkOut" th:value="${checkOut}" type="hidden">
                <input id="roomtitle" name="roomtitle" th:value="${roomtitle}" type="hidden">
                <input id="userCnt" name="userCnt" th:value="${userCnt}" type="hidden">
                <button class="reservBtn" id="reserveBtn" type="button">ê²°ì œ</button>
            </div>
        </div>
    </section>
</main>
<footer th:replace="~{layout/footer :: footer}"></footer>
</body>
</html>